# =============================================================================
# INFLUXDB STACK ADD-ON - DOCKER COMPOSE DEVELOPMENT CONFIGURATION
# =============================================================================
# PURPOSE: Alternative way to run the add-on for development and testing
# USAGE:   docker-compose -f test/docker-compose.dev.yml up -d
# 
# This compose file provides:
# 1. Easy development workflow with docker-compose
# 2. Automatic container restart on failure
# 3. Proper volume mounting for persistent data
# 4. Environment variable configuration
# 5. Network isolation for testing
#
# ADVANTAGES over build.sh:
# - Better for long-term development
# - Automatic restart on container failure
# - Easier to modify configuration
# - Better for team development
#
# REQUIREMENTS: Docker Desktop with docker-compose support
# =============================================================================

version: '3.8'

services:
  influxdb-stack:
    build: 
      context: ../influxdb-stack  # Build from influxdb-stack directory
      dockerfile: Dockerfile
    container_name: influxdb-stack-dev
    restart: unless-stopped
    init: true
    entrypoint: /init
    ports:
      - "8086:8086"  # InfluxDB web interface
      - "3000:3000"  # Grafana web interface
      - "8443:8443"  # VS Code interface
      - "80:80"      # NGINX ingress interface
    volumes:
      - ../test-data:/data  # Persistent configuration and data
    environment:
      - TZ=UTC  # Set timezone for consistent logging
    networks:
      - influxdb-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8086/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

networks:
  influxdb-network:
    driver: bridge
    name: influxdb-dev-network

volumes:
  influxdb_data:
    driver: local
  grafana_data:
    driver: local 